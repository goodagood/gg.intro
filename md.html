<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport"    content="width=device-width, initial-scale=1">
<meta name="description" content="" />
<meta name="keywords" content="" />

<!--
<link rel="stylesheet" href="node_modules/markdown-retro/css/retro.css">
-->
<link rel="stylesheet" href="css/Skeleton-2.0.4/css/normalize.css">
<link rel="stylesheet" href="css/Skeleton-2.0.4/css/skeleton.css">

<link rel="stylesheet" href="css/octicons/octicons.css">
<link rel="stylesheet" href="node_modules/mdi/css/materialdesignicons.css">

<link rel="stylesheet" href="css/md.css">
<link rel="stylesheet" href="css/y6.june.14.css" class="for_markdown_style">



<title> markdown renderring </title>


<!--
-->

<style>
</style>

</head>
<body>



<div class="row" id="header_div">
  <div id="site_name">goodogood.me ?</div>
  <div id="color_chooser">
      <span id="color_letter">clr.</span>
  </div>
  <div id="style_chooser">
      <i class="mdi mdi-dice-5"></i>
  </div>
</div><br class="cf">


<div class="row file_name_div">
  <i class="mdi mdi-arrow-right-bold-hexagon-outline"></i>
  <span class="file_name"> ./general/intro.md </span>
</div>

<div class="container">
  

  <!--
  <img width="90%" height="18px" src="../img/Decorative-Header-3--Arvin61r58.svg" >
  -->


  <!-- ======== start of block markdown wrapper  -->
  <div class="row">
    <div id="markdown_wrapper"></div>
    <div id="site_map"></div>
  </div>
  <!-- ======== end of block markdown wrapper,   -->


  <div class="row" id="footer">
    <hr>
      Andrew, goodogood.me, goodagood &copy; 2016-2018

      <img width="90%" src="./img/decorativedivider-sword.svg" >
      <!--
      Image from: <a target="_blank" 
      href="https://openclipart.org/detail/221190/decorative-divider-sword" >
      openclipart: j4p4n</a>
      -->
  </div>
</div>

<noscript><pre>
  Javascript support is needed to get and render 'markdown' text.
  # This 'message' should appear when Javascript not in place,
  # so markdown renderring might has been failed.
</pre></noscript>

<!--
  script.start
-->
<script src="node_modules/jquery/dist/jquery.min.js"></script>
<script src="node_modules/marked/marked.min.js"></script>

<script src="js/path.tools.js"></script>

<script>
const p = console.log.bind(console);
const Markdown_wrapper_selector = "#markdown_wrapper";
const Starter_file = "./general/be.simple.md";

window.Starter_file = Starter_file; //d

function gg_data($){
  var d = {
    file_path : './sitemap.md',
    pathes : [],
    index: 0,
    html_sitemap : ''
  };

  var obj = {};


  obj.add_file_path = (fpath) =>{
      d.pathes.push(fpath);
      // limit to 500 elements
      if(d.pathes.length > 500){
          uniqueArray = d.pathes.filter(function(item, pos) {
              return d.pathes.indexOf(item) == pos;
          });
          uniqueArray.shift();
          d.pathes = uniqueArray;
      }
  }

  obj.get_file_path = (fpath) =>{
    return d.pathes;
  }

  obj.get_html_sitemap = () =>{
    return d.html_sitemap;
  }

  // try to get site map and render it to html, no waiting.

  return obj;
}

var site_map = ($, file_path) =>{
  file_path =  file_path || './sitemap.md';

  var ajax_opt = {
    url : file_path,
    // data from server:
    dataType: 'text'
  };

  $.ajax(ajax_opt).done(function(md_text){
      //p(md_text);
      p('in site map ', typeof md_text, md_text.length);

      var md_html;
      try{
        md_html = marked(md_text);
        //p(md_html);
      }catch(e){
        p('FAILED TO MARKED THE TEXT');
        md_html = `<pre>md_text</pre>`;
      }
      $("#site_map").html(md_html);

  });
}


var get_and_render_to = ($, file_path, target_id) =>{
  file_path =  file_path || './sitemap.md';

  var ajax_opt = {
    url : file_path,
    // data from server:
    dataType: 'text'
  };

  $.ajax(ajax_opt).done(function(md_text){
      //p(md_text);
      p('in site map ', typeof md_text, md_text.length);

      var md_html;
      try{
        md_html = marked(md_text);
        //p(md_html);
      }catch(e){
        p('FAILED TO MARKED THE TEXT');
        md_html = `<pre>md_text</pre>`;
      }
      $(target_id).html(md_html);
  });
}



function get_and_render_markdown($, file_path, callback){
    $(".file_name").html(`${file_path}`).data('file_path', file_path);

    var ajax_opt = {
      url : file_path,
      // data from server:
      dataType: 'text'
    };

    $.ajax(ajax_opt).done(function(md_text){
      //p(md_text);
      p(typeof md_text, md_text.length);

      var md_html;
      try{
        md_html = marked(md_text);
        //p(md_html);
      }catch(e){
        p('FAILED TO MARKED THE TEXT');
        md_html = `<pre>md_text</pre>`;
      }
      $(Markdown_wrapper_selector).html(md_html);
      callback();
    });
}

function convert_relative_links_in_markdown($, url_){
  url_ = url_ || $(".file_name").data('file_path');
  p('in convert ... url_: ', url_);

  $(`${Markdown_wrapper_selector} a`).not(
  '[href^="http"],[href^="https"],[href^="mailto:"],[href^="#"]'
  ).each(function(){
      console.log('this', this);

      var href = $(this).attr('href');
      if(look_like_markdown(href)){
        var calculated = uresolve(url_, href);
        console.log('href: ', href, ' cal: ', calculated);

        $(this).click(function(e){
          e.preventDefault();

          get_and_render_markdown($, calculated, function(){
            convert_relative_links_in_markdown($);
          });
        });
      }

  });
}
var cc = convert_relative_links_in_markdown;

function color_click($){
  var fore = 0x000000;
  var back = 0xffffff;

  function cutHex(h) {return (h.charAt(0)=="#") ? h.substring(1,7):h}
  function hexToR(h) {return parseInt((cutHex(h)).substring(0,2),16)}
  function hexToG(h) {return parseInt((cutHex(h)).substring(2,4),16)}
  function hexToB(h) {return parseInt((cutHex(h)).substring(4,6),16)}

  function luminanace(r, g, b) {
      var a = [r,g,b].map(function(v) {
          v /= 255;
          return (v <= 0.03928) ?
              v / 12.92 :
              Math.pow( ((v+0.055)/1.055), 2.4 );
          });
      return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
  }

  function randomHex(){
      hex = Math.floor((Math.random() * 0xffFFff)).toString(16);
      while(hex.length < 6){ hex = '0' + hex; }
      return hex;
  }


  $("#color_letter").click(function(e){
    var contrast = 1;

    while(contrast < 3){
      fore = '#' + randomHex();
      var flum = luminanace(hexToR(fore), hexToG(fore), hexToB(fore));

      back = '#' + randomHex();
      var blum = luminanace(hexToR(back), hexToG(back), hexToB(back));

      contrast = (flum + 0.05)/(blum + 0.05);
      if(contrast < 1) contrast = 1/contrast;
      p('ratio: ', contrast, ' fore ground: ', fore, ' back: ', back);
    }
  
    $('body').css('color', fore);
    $('body').css('background-color', back);
    $(this).html(contrast.toString().substr(0,4));
  });
}

//--

function shift_style($){
  var chooser = $("#style_chooser");
  
  var csses = [
    "./css/y6.june.14.css",
    "./css/splendor.css",
    "./css/modest.css",
    "./css/air.css"
  ];

  var index = 0;

  obj = {};

  obj.shift_index = ()=>{
    index ++;
    if(index > csses.length) index = 0;
    return index;
  }

  chooser.click(function(e){
  });

  obj.changeCss = (css_file_href) =>{
      css_file_href = css_file_href || csses[obj.shift_index()];

      $('link.for_markdown_style[rel=stylesheet]').remove();

      // new link of css file:
      // You need to set the href attr last
      // and only after the link elem is appended to the head:

      $('<link>')
      .appendTo('head')
      .attr({type : 'text/css', rel : 'stylesheet', class: 'for_markdown_style'})
      .attr('href', css_file_href);
  }

  return obj;

  // ref:
  //// remove
  //$('link[rel=stylesheet][href~="foo.com"]').remove();
  //// or:
  //sheet = document.getElementById(styleSheetId)
  //sheet.parentNode.removeChild(sheet)

  //// get
  //$.getScript('ajax/test.js', function() {
  //  alert('Load was performed.');
  //  });
}
var ss = shift_style; //d


$(document).ready(function(){
  var url_ = Starter_file;
  get_and_render_markdown($, url_, function(){
    convert_relative_links_in_markdown($);
  });

  site_map($);
  color_click($);

  //console.log(marked('# Marked in browser\n\nRendered by **marked**.'));
  p('end of ready');
});

</script>

</body>
</html>
<!-- vim: et ts=2 sw=2
-->
